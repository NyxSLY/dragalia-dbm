"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ejs_1 = require("ejs");
const fs_1 = require("fs");
const path_1 = require("path");
const util_1 = require("./util");
const program = require("commander");
program
    .option('-m, --module', '是否创建为模块', false)
    .option('-j, --javascript', '是否创建javascript文件', false)
    .option('-d, --dir <dirname>', '文件目录', './')
    .parse(process.argv);
const config = util_1.getWorkspaceConfig();
const name = `${program.args[0] || `script${Date.now()}`}`;
const fname = `${name}.${program.opts().javascript ? 'auto.js' : 'auto.ts'}`;
const saveDir = (config && (config.generate && config.generate.dir)) || program.opts().dir;
const fullpath = path_1.resolve(saveDir, fname);
const data = {
    module: program.opts().module || false,
    javascript: program.opts().javascript || false,
    name: util_1.firstUpperCase(name)
};
console.log(`生成位置：${fullpath}`);
if (fs_1.existsSync(fullpath)) {
    throw "文件已存在";
}
else {
    util_1.mkdirsSync(path_1.dirname(fullpath));
    fs_1.writeFileSync(fullpath, ejs_1.render(fs_1.readFileSync(path_1.join(__dirname, '../template/script.ejs'), 'utf-8').replace(/(<script>(\r?\n?)|(\r?\n?)<\/script>)/g, ''), data));
}
